<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Iniciar sesi√≥n en SeniorInteract - Plataforma accesible para personas mayores">
    <title>Iniciar Sesi√≥n - SeniorInteract</title>
    
    <!-- Fuentes de Google -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Estilos CSS -->
    <link rel="stylesheet" href="../../dist/style.css">
    <link rel="stylesheet" href="../css/auth.css">
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-50">
    <!-- Contenedor principal -->
    <div class="contenedor-auth">
        <div class="tarjeta-auth">
            <!-- Encabezado -->
            <div class="encabezado-auth">
                <div class="icono-auth">
                    <span role="img" aria-label="Usuario">üë§</span>
                </div>
                <h1>Iniciar Sesi√≥n</h1>
                <p>Bienvenido de vuelta a SeniorInteract</p>
            </div>

            <!-- Formulario de login -->
            <form id="formulario-login" class="formulario-auth" novalidate>
                <!-- Campo Email -->
                <div class="grupo-campo">
                    <label for="email" class="etiqueta-campo etiqueta-requerida">
                        Correo Electr√≥nico
                    </label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email"
                        class="campo-auth"
                        placeholder="tu@email.com"
                        required
                        autocomplete="email"
                        aria-describedby="ayuda-email"
                    >
                    <div id="ayuda-email" class="mensaje-ayuda">
                        Ingresa el email con el que te registraste
                    </div>
                </div>

                <!-- Campo Contrase√±a -->
                <div class="grupo-campo">
                    <label for="clave" class="etiqueta-campo etiqueta-requerida">
                        Contrase√±a
                    </label>
                    <div class="relative">
                        <input 
                            type="password" 
                            id="clave" 
                            name="clave"
                            class="campo-auth"
                            placeholder="Tu contrase√±a"
                            required
                            autocomplete="current-password"
                            aria-describedby="ayuda-clave"
                        >
                        <button 
                            type="button" 
                            id="boton-mostrar-clave"
                            class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"
                            aria-label="Mostrar contrase√±a"
                        >
                            <span id="icono-ojo">üëÅÔ∏è</span>
                        </button>
                    </div>
                    <div id="ayuda-clave" class="mensaje-ayuda">
                        M√≠nimo 8 caracteres
                    </div>
                </div>

                <!-- Recordar sesi√≥n -->
                <div class="checkbox-auth">
                    <input type="checkbox" id="recordar" name="recordar">
                    <label for="recordar">Recordar mi sesi√≥n</label>
                </div>

                <!-- Bot√≥n de env√≠o -->
                <button type="submit" class="boton-auth-primario" id="boton-login">
                    Iniciar Sesi√≥n
                </button>

                <!-- Enlace recuperar contrase√±a -->
                <div class="text-center">
                    <a href="recuperar.html" class="enlace-auth">
                        ¬øOlvidaste tu contrase√±a?
                    </a>
                </div>
            </form>

            <!-- Separador -->
            <div class="separador-auth">
                <span>o</span>
            </div>

            <!-- Bot√≥n registro -->
            <a href="registro.html" class="boton-auth-secundario block text-center">
                Crear Nueva Cuenta
            </a>

            <!-- Pie del formulario -->
            <div class="pie-auth">
                <p>
                    <a href="../../index.html" class="enlace-auth">
                        ‚Üê Volver al inicio
                    </a>
                </p>
                <p class="text-xs text-gray-500 mt-4">
                    Al iniciar sesi√≥n, aceptas nuestros t√©rminos de servicio y pol√≠tica de privacidad
                </p>
            </div>
        </div>
    </div>

    <!-- Contenedor de mensajes (se crea din√°micamente) -->
    <div id="contenedor-mensajes"></div>

    <!-- Scripts -->
    <script src="../js/config.js"></script>
    <script src="../js/auth.js"></script>
    <script>
        // Script espec√≠fico para la p√°gina de login
        document.addEventListener('DOMContentLoaded', function() {
            const formularioLogin = document.getElementById('formulario-login');
            const botonMostrarClave = document.getElementById('boton-mostrar-clave');
            const campoClave = document.getElementById('clave');
            const iconoOjo = document.getElementById('icono-ojo');
            const botonLogin = document.getElementById('boton-login');

            // Verificar si ya hay una sesi√≥n activa
            if (window.GestorSesion && window.GestorSesion.sesionActiva()) {
                window.SistemaAuth.mostrarMensaje('Ya tienes una sesi√≥n activa', 'info');
                setTimeout(() => {
                    window.location.href = '../../index.html';
                }, 2000);
                return;
            }

            // Manejar env√≠o del formulario
            formularioLogin.addEventListener('submit', async function(evento) {
                evento.preventDefault();
                
                const datosFormulario = new FormData(formularioLogin);
                const email = datosFormulario.get('email').trim();
                const clave = datosFormulario.get('clave');

                // Guardar texto original del bot√≥n
                const textoOriginal = botonLogin.textContent;
                
                try {
                    const exito = await window.SistemaAuth.iniciarSesion(email, clave);
                    
                    if (exito) {
                        botonLogin.textContent = 'Redirigiendo...';
                        // La redirecci√≥n se maneja en el sistema de auth
                    }
                } finally {
                    // Restaurar texto del bot√≥n si no fue exitoso
                    setTimeout(() => {
                        if (botonLogin.textContent !== 'Redirigiendo...') {
                            botonLogin.textContent = textoOriginal;
                        }
                    }, 100);
                }
            });

            // Mostrar/ocultar contrase√±a
            botonMostrarClave.addEventListener('click', function() {
                if (campoClave.type === 'password') {
                    campoClave.type = 'text';
                    iconoOjo.textContent = 'üôà';
                    botonMostrarClave.setAttribute('aria-label', 'Ocultar contrase√±a');
                } else {
                    campoClave.type = 'password';
                    iconoOjo.textContent = 'üëÅÔ∏è';
                    botonMostrarClave.setAttribute('aria-label', 'Mostrar contrase√±a');
                }
            });

            // Validaci√≥n en tiempo real
            const campoEmail = document.getElementById('email');
            
            campoEmail.addEventListener('blur', function() {
                if (this.value && !window.Validadores.validarEmail(this.value)) {
                    this.setCustomValidity('Por favor, ingresa un email v√°lido');
                    this.reportValidity();
                } else {
                    this.setCustomValidity('');
                }
            });

            campoClave.addEventListener('blur', function() {
                if (this.value && !window.Validadores.validarClave(this.value)) {
                    this.setCustomValidity('La contrase√±a debe tener al menos 8 caracteres');
                    this.reportValidity();
                } else {
                    this.setCustomValidity('');
                }
            });

            // Limpiar mensajes de error al escribir
            [campoEmail, campoClave].forEach(campo => {
                campo.addEventListener('input', function() {
                    this.setCustomValidity('');
                });
            });

            // Enfocar el primer campo
            campoEmail.focus();
        });
    </script>
</body>
</html>
